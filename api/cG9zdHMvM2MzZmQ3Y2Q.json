{"title":"用pmset管理macOS的睡眠","date":"2022-01-19T12:44:01.000Z","date_formatted":{"ll":"2022年1月19日","L":"2022/01/19","MM-DD":"01-19"},"link":"posts/3c3fd7cd","comments":true,"tags":["Mac"],"updated":"2022-01-20T06:18:35.706Z","content":"<h1 id=\"用-pmset-管理-macos-的睡眠\">用 pmset 管理 macOS 的睡眠<a href=\"#用-pmset-管理-macos-的睡眠\" title=\"用 pmset 管理 macOS 的睡眠\"></a></h1><blockquote>\n<p>Power Manager Setting (pmset) 是 macOS 的系统级电池管理工具，通过调整 macOS 的睡眠计划，可以让Mac睡得更「好」，达到 「插电响应快，断电用得久」 的理想目标。</p>\n</blockquote>\n<h2 id=\"mac-是怎么睡觉的？\">Mac 是怎么睡觉的？<a href=\"#mac-是怎么睡觉的？\" title=\"Mac 是怎么睡觉的？\"></a></h2><p>Mac 的睡觉分成两种，<strong>「睡眠」 (sleep)</strong> 和 <strong>「休眠」 (hibernate)</strong>。简单点说，睡眠和休眠就好比人的小憩和睡大觉，小憩醒得快，睡大觉就醒得慢。</p>\n<p>当你长时间不操作 Mac 或把 MacBook 的盖子合上或点击 Apple Logo 菜单下的 Sleep 选项，系统会进入<strong>「睡眠」</strong>状态，由于数据仍存储在内存中，此时系统可以被快速唤醒，快速恢复到睡眠前的状态。</p>\n<p>在「睡眠」一段时间后，Mac 会根据你的设定进入更深一层的 <strong>「休眠」</strong> 状态，此时 Mac 会考虑将内存中的数据作为一个镜像写入到硬盘中（GB 级别大小），然后放弃内存供电，达到更加省电的目的。此时唤醒系统，数据需要从硬盘重新装载至内存，耗时长，速度慢。</p>\n<p>总结一下，「睡眠」和「休眠」的主要区别：</p>\n<ul><li>唤醒速度快慢</li>\n<li>是否向内存供电</li>\n<li>是否向硬盘写入内存镜像</li>\n</ul><p>当然，Mac 到底要怎么「睡」，我们是可以通过 <code>pmset</code> 调整的。</p>\n<h2 id=\"macos-系统睡眠流程\">macOS 系统睡眠流程<a href=\"#macos-系统睡眠流程\" title=\"macOS 系统睡眠流程\"></a></h2><img src=\"https://cdn.jsdelivr.net/gh/autumndx/cdn/img/mac/202201192058140.jpg\" alt=\"macOS睡眠流程图\" style=\"zoom:50%;\" /><p>如图所示，当我们不使用 Mac 时，一段时候后，系统先进入 <code>sleep</code> 状态，然后根据 <code>hibernatemode</code> 的模式，决定将镜像数据写入内存还是硬盘。</p>\n<p><code>standby</code> 和 <code>autopoweroff</code> 相当于两个并行的模式计时器，Mac 会根据当前供电条件作出模式的选择，在计时器阶段内，当时间条件满足，Mac 就会将镜像写入硬盘并休眠。</p>\n<h2 id=\"pmset-用法\">pmset 用法<a href=\"#pmset-用法\" title=\"pmset 用法\"></a></h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo pmset [-选项] &lt;参数&gt;</span><br></pre></td></tr></table></figure><p>例子：</p>\n<ul><li><code>pmset -g custom</code>：<strong><font color=\"red\">查看当前所有休眠计划</font></strong></li>\n<li><code>pmset -g cap</code>：查看当前供电条件下可以调节的参数</li>\n<li><code>sudo pmset restoredefaults</code>：还原全部设置</li>\n</ul><h3 id=\"常用选项\">常用选项<a href=\"#常用选项\" title=\"常用选项\"></a></h3><ul><li><code>pmset -a</code>：调整任何条件下的休眠计划</li>\n<li><code>pmset -c</code>：调整外部供电的休眠计划</li>\n<li><code>pmset -b</code>：调整电池供电的休眠计划</li>\n<li><code>pmset -g</code>：查看计划</li>\n</ul><h3 id=\"常用参数\">常用参数<a href=\"#常用参数\" title=\"常用参数\"></a></h3><p><strong><mark><font color=\"red\">更多参数在终端运行 <code>$ man pmset</code>, 查阅 <code>pmset</code> 的说明</font></mark></strong></p>\n<p><font color=\"red\"><strong>搜索关键字方法</strong>：<code>/关键字</code>   例 ： <code>/sleep</code></font></p>\n<h4 id=\"sleep\">sleep<a href=\"#sleep\" title=\"sleep\"></a></h4><p>sleep 控制进入休眠所需要的空闲时间</p>\n<p><strong><font color=\"red\">【sleep &gt;= disksleep &gt;= display sleep】</font></strong></p>\n<h4 id=\"hibernatemode\">hibernatemode<a href=\"#hibernatemode\" title=\"hibernatemode\"></a></h4><blockquote>\n<p>hibernatemode supports values of 0, 3, or 25. Whether or not a hibernation image gets written is also dependent on the values of standby and autopoweroff.</p>\n</blockquote>\n<img src=\"https://cdn.jsdelivr.net/gh/autumndx/cdn/img/mac/202201192127594.png\" alt=\"hibernatemode\" style=\"zoom:67%;\" /><p>hibernatemode 负责管理休眠模式。值得注意的是，休眠时的内存镜像是否写入硬盘，除了受 <code>hibernatemode</code> 的控制，还和 <code>standby</code> 以及 <code>autopoweroff</code> 的值有关。</p>\n<p>hibernatemode 有 3 种休眠模式可选择</p>\n<ul><li><p><code>hibernatemode = 0</code></p>\n</li>\n<li><ul><li><strong>iMac, Mac Mini等 Mac桌面设备默认参数</strong></li>\n<li>持续向内存供电，将数据保留在内存</li>\n<li>唤醒速度快，减少硬盘占用</li>\n<li>数据有丢失风险</li>\n<li>耗电量大</li>\n</ul></li>\n<li><p><code>hibernatemode = 25</code></p>\n</li>\n<li><ul><li>将数据写入硬盘</li>\n<li>不向内存供电，将内存镜像直接写入硬盘</li>\n<li>数据不易丢失，镜像占用硬盘空间</li>\n<li>唤醒速度慢</li>\n<li>耗电量少</li>\n</ul></li>\n<li><p><code>hibernatemode = 3</code></p>\n</li>\n<li><ul><li><strong>MacBook 笔记本设备默认参数</strong></li>\n<li>safe sleep, 数据既写入内存又写入硬盘</li>\n<li>持续向内存供电</li>\n<li>唤醒时，根据设备电量自动选择从 内存/硬盘 恢复</li>\n</ul></li>\n<li></li>\n<li><p>具体说明下hibernatemode参数，详细如下：</p>\n</li>\n<li><blockquote>\n<p>Mac的sleep mode在os x系统里有一个准确的叫法是HibernateMode，它有三个值：0、25、3<br><strong>Mode: 0</strong><br>当 HibernateMode 的值为 0 时 ，设备里除了 RAM（内存）外，键盘，显示器，鼠标等所有内外工作模块都会断开电源（或电池供应），此时系统不会将内存的数据写入硬盘，如果到设备被再次唤醒之前，电源线一直接入或者电池电量足够，那么用户在开盖后可立刻唤醒 Mac。<br>这种模式的优点明显，就是她不会向硬盘写数据，也就是设备在深度睡眠（一般成为休眠）时不会产生内存镜像，即能减少硬盘的占用率，也能让唤醒操作立刻完成。但请注意，许多事情有优点也有缺点，那就是当设备处于睡眠过程中时，电源线没插上，电池电量耗尽，那内存的供电就会自动中断，内存里保存的数据也会自动清除。OS X系统自身默认没有选择它。<br><strong>Mode: 25</strong><br>当 HibernateMode 的值为 25 时，设备里所有模块均断电，内存数据被全部写入硬盘，硬盘里有一个专门负责“休眠”的内存镜像文件，当设备从“休眠”中恢复时，会自动调用保存好的内存镜像文件，将数据重新写回内存中，受硬盘的输入输出速率影响，这个过程会很漫长，所以许多朋友会在唤醒时看到屏幕里有进度条，千万别认为你的设备硬件不够用了，该换电脑了，别听奸商的忽悠，Mac 的产品寿命可比手机长多了，回到正题，在数据被完全写回内存后，Mac 才能被完全唤醒。这种模式优点明显，无需单独为内存供电，内存的数据不容易被丢失，缺点就是唤醒时间较长。<br><strong>Mode: 3</strong><br>第三项值就是 OS X 默认选择的，这种状态下也叫：“<strong>Safe Sleep</strong>”，人们还叫她是“混合休眠模式”，这种模式结合了前两种模式的长处，设备进入睡眠后，内存仍然保持供电，但仍然会将数据写入硬盘，这样内存的数据就同时被保存在两个硬件模块里，如果在唤醒时，设备电量充足（或够用），那 Mac 就会像 Mode 0 一样快速被唤醒，如果唤醒操作前，设备电量已不足了或者已经被耗尽，此时插上电源线后，系统会自动从硬盘里的内存镜像文件中恢复内存，而唤醒过程和 Mode 1 一样慢。这种模式优缺点就不用再用我说了吧，非常灵活。</p>\n</blockquote>\n</li>\n</ul><h4 id=\"standby\">standby<a href=\"#standby\" title=\"standby\"></a></h4><blockquote>\n<p>standby causes kernel power management to automatically hibernate a machine after it has slept for a specified time period.</p>\n</blockquote>\n<p>standby 是 Mac 在休眠时的计时器，当满足时间条件，Mac就会由「睡眠」状态转至「休眠」状态。</p>\n<p>standby模式需要以下条件：</p>\n<ul><li><strong>电池供电</strong></li>\n<li>没有外接设备</li>\n<li>没有网络活动</li>\n<li>没有外接显示器</li>\n</ul><p>在满足条件的前提下， <code>standbydelayhigh/low</code> 秒后，会进行休眠。比较人性化的的一点是，standby 提供了两个倒计时，通过一个阈值 (<code>highstandbythreshold</code>) 进行控制。</p>\n<h5 id=\"highstandbythreshold\">highstandbythreshold<a href=\"#highstandbythreshold\" title=\"highstandbythreshold\"></a></h5><p>highstandbythreshold(电池剩余电量百分比)它是<code>standbydelay</code>模式选择阈值，默认 50% 电量。</p>\n<ul><li>高于阈值，采用 <code>standbydelayhigh</code> 计算时间。</li>\n<li>低于阈值，采用 <code>standbydelaylow</code> 计算时间。</li>\n</ul><h5 id=\"autopoweroff\">autopoweroff<a href=\"#autopoweroff\" title=\"autopoweroff\"></a></h5><blockquote>\n<p>autopoweroff is enabled by default on supported platforms as an implementation of Lot 6 to the European Energy-related Products Directive. After sleeping for <autopoweroffdelay> seconds, the system will write a hibernation image and go into a lower power chipset sleep. Wakeups from this state will take longer than wakeups from regular sleep.</p>\n</blockquote>\n<p>autppoweroff 是为了满足 <a href=\"https://link.zhihu.com/?target=https%3A//ac-dc.powerint.cn/sites/default/files/greenroom/docs/EC_1275_2008PublishedRegulation.pdf\" target=\"_blank\">欧盟能源效率 Lot 6 条例</a>（关于待机和关闭模式的要求）而设计的，但并不是全部设备都有这个这个设定，需要通过 <code>pmset -g cap</code> 查看是否能调节此项参数。</p>\n<p><code>autopoweroff</code>模式需要满足以下条件：</p>\n<ul><li><strong>外部电源供电</strong></li>\n<li>没有外接设备</li>\n<li>没有网络活动</li>\n</ul><p>在满足条件的前提下, <code>autopoweroffdelay</code>秒后，系统会写入内存镜像然后休眠。与上文提到的 <code>standby</code> 不同，<code>autppoweroff</code> 更多是为了连接外部电源充电时设计的。</p>\n<h4 id=\"powernap\">powernap<a href=\"#powernap\" title=\"powernap\"></a></h4><p>在配备闪存的 Mac 电脑上，电能小憩功能可让某些 Mac 电脑即使处于睡眠状态，也可以保持最新。当 Mac 进入睡眠状态后，电能小憩功能会定期激活以更新信息。所更新的信息取决于您的 Mac 是使用电池供电（Mac 笔记本电脑）还是接入了电源适配器（Mac 笔记本电脑或 Mac 台式电脑）。</p>\n<p><strong>当 Mac 处于睡眠状态并使用电池供电时，电能小憩功能会：</strong></p>\n<p>检查“邮件”中的新邮件</p>\n<p>更新“日历”中的日程</p>\n<p>更新其他 iCloud 日程</p>\n<p><strong>将 Mac 接入电源适配器时</strong>，电能小憩功能还能进行诸如下载软件更新和执行时间机器备份等活动。</p>\n<h4 id=\"womp\">womp<a href=\"#womp\" title=\"womp\"></a></h4><p>以太网数据包唤醒（值=0/1）。与“节能器”首选项中的“唤醒网络访问”相同。</p>\n<h4 id=\"ttyskeepawake\">ttyskeepawake<a href=\"#ttyskeepawake\" title=\"ttyskeepawake\"></a></h4><p>当任何tty(例如，远程登录会话)处于“活动”状态时，防止空闲系统休眠。仅当TTY的空闲时间超过系统休眠计时器时，TTY才是“不活动的”。(值=0/1)</p>\n<h4 id=\"gpuswitch\">gpuswitch<a href=\"#gpuswitch\" title=\"gpuswitch\"></a></h4><p><code>gpuswitch</code> 这个参数用于管理显卡的选择，适合有独立显卡/外置显卡的 Mac</p>\n<ul><li><code>gpuswitch=0</code> 只使用集成显卡</li>\n<li><code>gpuswitch=1</code> 只使用独立显卡</li>\n<li><code>gpuswitch=2</code> 自动切换显卡</li>\n</ul><p>调节这个参数可以避免在电池供电时使用耗电量高的独立显卡，以节省电量。</p>\n<h4 id=\"其他常用参数\">其他常用参数<a href=\"#其他常用参数\" title=\"其他常用参数\"></a></h4><ul><li><code>lidwake</code>：开盖时是否唤醒</li>\n<li><code>tcpkeepalive</code>：合盖时是否保存网络连接</li>\n<li><code>displaysleep</code>：屏幕休眠时间</li>\n<li><code>disksleep</code>： 硬盘休眠时间</li>\n<li><code>acwake</code>: 被同一 iCloud ID 下的设备唤醒</li>\n</ul><p>在终端输入：pmset -g custom  这个命令可以显示系统所有的电源设置（更详细的介绍请看<a href=\"http://https//developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man1/pmset.1.html\" target=\"_blank\">Apple开发者文档</a>）：</p>\n<div class=\"φcz\"><div class=\"φdb\"><table><thead><tr>\n<th>Battery Power</th><th>用电池时的电源设置</th></tr>\n</thead><tbody><tr>\n<td>AC Power</td><td>外接电源时的电源设置</td></tr>\n<tr>\n<td>lidwake</td><td>当屏幕掀开的时候唤醒Mac，1是开启 0是关闭</td></tr>\n<tr>\n<td>autopoweroff</td><td>如果Mac处于睡眠状态经过指定的时间后，自动把内存数据写入硬盘，并切断所有部件的电源，进入休眠状态，1是开启 0是关闭。</td></tr>\n<tr>\n<td>autopoweroffdelay</td><td>启用autopoweroff功能的时间，也就是上面说的那个“指定的时间”，单位是秒</td></tr>\n<tr>\n<td>standby</td><td>功能跟autopoweroff一样，不过仅在hibernatemode为3的时候起作用，1是开启 0是关闭。</td></tr>\n<tr>\n<td>standbydelay</td><td>启用standby功能的时间，单位也是秒</td></tr>\n<tr>\n<td>ttyskeepawake</td><td>远程用户正在活动时防止Mac进入睡眠，1是开启 0是关闭</td></tr>\n<tr>\n<td>hibernatemode</td><td>睡眠模式</td></tr>\n<tr>\n<td>darkwakes</td><td>这个就是Power Nap，你可以在系统偏好设置里选择开或关，跟在这里设置是一样的，1是开启 0是关闭</td></tr>\n<tr>\n<td>hibernatefile</td><td>内存镜像存放的地址，这个也可以更改，不过路径必需是root下的路径</td></tr>\n<tr>\n<td>displaysleep</td><td>Mac闲置多长时间后进入显示器睡眠，单位是分钟，这个时间不能长于sleep下设置的时间</td></tr>\n<tr>\n<td>sleep</td><td>Mac闲置多长时间后进入睡眠，这个系统偏好设置里也有，单位是分钟</td></tr>\n<tr>\n<td>acwake</td><td>电源改变时唤醒，也就是插上或者拔掉外置电源时唤醒Mac，1是开启 0是关闭</td></tr>\n<tr>\n<td>halfdim</td><td>显示器睡眠时使显示器亮度改变为当前亮度的一半，1是开启 0是关闭。如果关闭这个功能的话，显示器睡眠会直接关掉显示器。</td></tr>\n<tr>\n<td>lessbright</td><td>使用电池时使显示器亮度暗一点，系统偏好设置里也有这个，1是开启 0是关闭</td></tr>\n<tr>\n<td>disksleep</td><td>Mac闲置多长时间后关闭硬盘。这个系统偏好里也有，只不过换了一个字眼—如果可能，使硬盘进入睡眠—勾上这个的话系统就会自动根据sleep的时间设一个合适的时间。单位是秒，这个时间不能长于sleep下设置的时间</td></tr>\n<tr>\n<td>sleepservice</td><td></td></tr>\n<tr>\n<td>womp</td><td>网络远程唤醒，1是开启 0是关闭</td></tr>\n<tr>\n<td>networksleep</td><td>这个设置影响Mac在睡眠的过程中如何提供网络共享服务</td></tr>\n</tbody></table></div></div><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lidwake<span class=\"comment\">// 当屏幕掀开的时候唤醒Mac，1是开启  0是关闭 </span></span><br><span class=\"line\"></span><br><span class=\"line\">autopoweroff<span class=\"comment\">// 如果Mac处于睡眠状态经过指定的时间后，自动把内存数据写入硬盘，并切断所有部件的电源，进入休眠状态，1是开启  0是关闭。但是LZ发现就算是处于开启状态，这个功能也并没有起作用，你可以不管它，也可以关掉 </span></span><br><span class=\"line\"></span><br><span class=\"line\">autopoweroffdelay<span class=\"comment\">//启用autopoweroff功能的时间，也就是上面说的那个“指定的时间”，单位是秒 </span></span><br><span class=\"line\"></span><br><span class=\"line\">standby<span class=\"comment\">//功能跟autopoweroff一样，不过仅在hibernatemode为3的时候起作用，1是开启 0是关闭。不过LZ一直没搞明白autopoweroff跟standby有什么不一样，按理说应该是不一样的 </span></span><br><span class=\"line\"></span><br><span class=\"line\">standbydelay<span class=\"comment\">//启用standby功能的时间，单位也是秒 </span></span><br><span class=\"line\"></span><br><span class=\"line\">ttyskeepawake<span class=\"comment\">//远程用户正在活动时防止Mac进入睡眠，1是开启  0是关闭 </span></span><br><span class=\"line\"></span><br><span class=\"line\">hibernatemode<span class=\"comment\">//睡眠模式 </span></span><br><span class=\"line\"></span><br><span class=\"line\">darkwakes<span class=\"comment\">//这个就是Power Nap，你可以在系统偏好设置里选择开或关，跟在这里设置是一样的，1是开启  0是关闭 </span></span><br><span class=\"line\"></span><br><span class=\"line\">hibernatefile<span class=\"comment\">//内存镜像存放的地址，这个也可以更改，不过路径必需是root下的路径 </span></span><br><span class=\"line\"></span><br><span class=\"line\">displaysleep<span class=\"comment\">//Mac闲置多长时间后进入显示器睡眠，2013款Air的系统偏好设置里已经没有这个选项了，Pro是有的，不过其实你可以通过pmset来修改。单位是分钟，这个时间不能长于sleep下设置的时间 </span></span><br><span class=\"line\"></span><br><span class=\"line\">sleep<span class=\"comment\">//Mac闲置多长时间后进入睡眠，这个系统偏好设置里也有，单位是分钟 </span></span><br><span class=\"line\"></span><br><span class=\"line\">acwake<span class=\"comment\">//电源改变时唤醒，也就是插上或者拔掉外置电源时唤醒Mac，1是开启  0是关闭 </span></span><br><span class=\"line\"></span><br><span class=\"line\">halfdim<span class=\"comment\">//显示器睡眠时使显示器亮度改变为当前亮度的一半，1是开启  0是关闭。如果关闭这个功能的话，显示器睡眠会直接关掉显示器。 </span></span><br><span class=\"line\"></span><br><span class=\"line\">lessbright<span class=\"comment\">//使用电池时使显示器亮度暗一点，系统偏好设置里也有这个，1是开启  0是关闭 </span></span><br><span class=\"line\"></span><br><span class=\"line\">disksleep<span class=\"comment\">//Mac闲置多长时间后关闭硬盘。这个系统偏好里也有，只不过换了一个字眼—如果可能，使硬盘进入睡眠—勾上这个的话系统就会自动根据sleep的时间设一个合适的时间。单位是秒，这个时间不能长于sleep下设置的时间 </span></span><br><span class=\"line\"></span><br><span class=\"line\">sleepservice<span class=\"comment\">//LZ还没搞清楚这个是干嘛的，请知道的锋友解释下。 </span></span><br><span class=\"line\"></span><br><span class=\"line\">womp<span class=\"comment\">//网络远程唤醒，1是开启  0是关闭 </span></span><br><span class=\"line\"></span><br><span class=\"line\">networksleep<span class=\"comment\">//这个设置影响Mac在睡眠的过程中如何提供网络共享服务，LZ也不太清楚是什么，最好就不要动。</span></span><br></pre></td></tr></table></figure><h2 id=\"个人设置方案\">个人设置方案<a href=\"#个人设置方案\" title=\"个人设置方案\"></a></h2><p>我个人所希望的休眠计划是：外接供电条件下响应尽可能快，电池供电条件下耗电少。</p>\n<h3 id=\"⚡️-外部供电下的-pmset-设置\">⚡️ 外部供电下的 pmset 设置<a href=\"#⚡️-外部供电下的-pmset-设置\" title=\"⚡️ 外部供电下的 pmset 设置\"></a></h3><img src=\"https://cdn.jsdelivr.net/gh/autumndx/cdn/img/mac/202201192132915.png\" alt=\"外部供电时的设置\" style=\"zoom: 33%;\" /><p>在进行外部供电的时候，我希望 MacBook 是处于一个 <strong>「时刻准备着」</strong> 的状态（参考 iMac ），因此我希望我的 Mac能清醒更久，并且永不 「休眠」。因此我会作出以下设置：</p>\n<p><strong>永不休眠：</strong></p>\n<ul><li><code>hibernatemode</code> 设置成 <code>0</code>，让外部电源持续给内存供电。</li>\n<li>关闭 <code>standyby</code> 和 <code>autopoweroff</code> 模式，阻止 MacBook 休眠。</li>\n</ul><p><strong>详细设置：</strong></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 25 分钟后进入睡眠，延长清醒时间</span></span><br><span class=\"line\">sudo pmset -<span class=\"built_in\">c</span> sleep <span class=\"number\">25</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 显示器睡眠时间：3 分钟</span></span><br><span class=\"line\">sudo pmset -<span class=\"built_in\">c</span> displaysleep <span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 硬盘睡眠时间：10 分钟</span></span><br><span class=\"line\">sudo pmset -<span class=\"built_in\">c</span> disksleep <span class=\"number\">10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 内存供电，内存镜像不写入硬盘</span></span><br><span class=\"line\">sudo pmset -<span class=\"built_in\">c</span> hibernatemode <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 关闭 standby 模式</span></span><br><span class=\"line\">sudo pmset -<span class=\"built_in\">c</span> standby <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 关闭 autopoweroff</span></span><br><span class=\"line\">sudo pmset -<span class=\"built_in\">c</span> autopoweroff <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 休眠时持续联网</span></span><br><span class=\"line\">sudo pmset -<span class=\"built_in\">c</span> tcpkeepalive <span class=\"number\">1</span></span><br></pre></td></tr></table></figure><h3 id=\"🔋电池供电下的-pmset-设置\">🔋电池供电下的 pmset 设置<a href=\"#🔋电池供电下的-pmset-设置\" title=\"🔋电池供电下的 pmset 设置\"></a></h3><img src=\"https://cdn.jsdelivr.net/gh/autumndx/cdn/img/mac/202201192133677.png\" alt=\"电池供电时的设置\" style=\"zoom:33%;\" /><p>在通过电池供电的时候，我希望 Mac 能耗电少一些，同时「休眠」后唤醒速度不太慢。因此我会作出以下设置：</p>\n<ul><li><code>hibernatemode</code> 为 <code>3</code>，将镜像数据既写入内存又写入硬盘，同时对内存只供电一段时间。</li>\n<li><code>standby</code> 的电量阈值设置成 <code>75%</code>，当电量低于 75% stanby的计时器就使用 <code>standbydelaylow</code> 作为休眠倒计时。</li>\n<li><code>tcpkeepalive</code> 设置成 <code>0</code>, 休眠时电脑将会断网，以节省电量。但此时无法进行下载工作，<strong>FindMy 也无法定位。</strong></li>\n<li><code>proximitywake</code> 设置成 0, 关闭被同一网络下的同 iCloud 设备唤醒</li>\n</ul><p><strong>详细设置：</strong></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 10 分钟后进入睡眠</span></span><br><span class=\"line\">sudo pmset -b sleep <span class=\"number\">10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//关闭电能小憩</span></span><br><span class=\"line\">sudo pmset -b powernap <span class=\"number\">0</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//关闭ttyskeepawake</span></span><br><span class=\"line\">sudo pmset -b ttyskeepawake <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 休眠时内存供电</span></span><br><span class=\"line\">sudo pmset -b hibernatemode <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//开启自动睡眠转休眠</span></span><br><span class=\"line\">sudo pmset -b standby <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 显示器休眠时间：3 分钟</span></span><br><span class=\"line\">sudo pmset -b displaysleep <span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 硬盘睡眠时间：10 分钟</span></span><br><span class=\"line\">sudo pmset -b disksleep <span class=\"number\">10</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 休眠时断网</span></span><br><span class=\"line\">sudo pmset -b tcpkeepalive <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 高电量下 standby: 4小时</span></span><br><span class=\"line\">sudo pmset -b standbydelayhigh <span class=\"number\">14400</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 低电量下 standby: 2小时</span></span><br><span class=\"line\">sudo pmset -b standbydelaylow <span class=\"number\">7200</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//standby 电量阈值：50%</span></span><br><span class=\"line\">sudo pmset -b highstandbythreshold <span class=\"number\">50</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//关闭电源和电池供电切换时唤醒</span></span><br><span class=\"line\">sudo pmset -a acwake <span class=\"number\">0</span></span><br></pre></td></tr></table></figure><p>参考资料:</p>\n<ul><li>StackExchange: <a href=\"https://link.zhihu.com/?target=https%3A//apple.stackexchange.com/questions/113954/difference-between-autopoweroff-and-standby-in-pmset\" target=\"_blank\">Difference between autopoweroff and standby in pmset</a></li>\n<li>tutsplus: <a href=\"https://link.zhihu.com/?target=https%3A//computers.tutsplus.com/tutorials/how-to-hibernate-a-mac--cms-23235\" target=\"_blank\">How to Hibernate a Mac</a></li>\n<li>WikiPedia: <a href=\"https://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Pmset\" target=\"_blank\">pmset</a></li>\n</ul><blockquote>\n<p>P.S. 「Hibernate」 英文直译为「睡得深的睡眠，如冬眠」，本文取「休眠」之义，以表达设备的低功耗运作。</p>\n</blockquote>\n","prev":{"title":"Macbook优化","link":"posts/3c3fd7cd"},"next":{"title":"解决github图片加载不出来","link":"posts/7cd4f2fa"},"plink":"https://dxsummer.gitee.io/posts/3c3fd7cd/","toc":[{"id":"用-pmset-管理-macos-的睡眠","title":"用 pmset 管理 macOS 的睡眠","index":"1","children":[{"id":"mac-是怎么睡觉的？","title":"Mac 是怎么睡觉的？","index":"1.1"},{"id":"macos-系统睡眠流程","title":"macOS 系统睡眠流程","index":"1.2"},{"id":"pmset-用法","title":"pmset 用法","index":"1.3","children":[{"id":"常用选项","title":"常用选项","index":"1.3.1"},{"id":"常用参数","title":"常用参数","index":"1.3.2","children":[{"id":"sleep","title":"sleep","index":"1.3.2.1"},{"id":"hibernatemode","title":"hibernatemode","index":"1.3.2.2"},{"id":"standby","title":"standby","index":"1.3.2.3"},{"id":"powernap","title":"powernap","index":"1.3.2.4"},{"id":"womp","title":"womp","index":"1.3.2.5"},{"id":"ttyskeepawake","title":"ttyskeepawake","index":"1.3.2.6"},{"id":"gpuswitch","title":"gpuswitch","index":"1.3.2.7"},{"id":"其他常用参数","title":"其他常用参数","index":"1.3.2.8"}]}]},{"id":"个人设置方案","title":"个人设置方案","index":"1.4","children":[{"id":"⚡️-外部供电下的-pmset-设置","title":"⚡️ 外部供电下的 pmset 设置","index":"1.4.1"},{"id":"🔋电池供电下的-pmset-设置","title":"🔋电池供电下的 pmset 设置","index":"1.4.2"}]}]}],"reward":true,"copyright":{"author":"DxSummer","link":"<a href=\"https://dxsummer.gitee.io/posts/3c3fd7cd/\" title=\"用pmset管理macOS的睡眠\">https://dxsummer.gitee.io/posts/3c3fd7cd/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","published":"2022年1月19日","updated":"2022年1月20日"}}