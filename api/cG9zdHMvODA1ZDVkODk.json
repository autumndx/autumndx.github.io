{"title":"hexo博客开启pwa","date":"2020-05-08T04:41:25.000Z","date_formatted":{"ll":"2020年5月8日","L":"2020/05/08","MM-DD":"05-08"},"link":"posts/805d5d89","comments":true,"categories":["博客"],"updated":"2020-06-08T01:53:02.940Z","content":"<h1 id=\"前言\">前言<a href=\"#前言\" title=\"前言\"></a></h1><p><code>Progressive Web App</code>, 简称<code>PWA</code>，是提升 Web App 的体验的一种新方法，能给用户原生应用的体验。</p>\n<p><code>PWA</code> 能做到原生应用的体验不是靠特指某一项技术，而是经过应用一些新技术进行改进，在安全、性能和体验三个方面都有很大提升，PWA 本质上是 Web App，借助一些新技术也具备了 Native App 的一些特性，兼具 Web App 和 Native App 的优点。</p>\n<p>PWA 的主要特点包括下面三点：</p>\n<ul><li>可靠 - 即使在不稳定的网络环境下，也能瞬间加载并展现</li>\n<li>体验 - 快速响应，并且有平滑的动画响应用户的操作</li>\n<li>粘性 - 像设备上的原生应用，具有沉浸式的用户体验，用户可以添加到桌面</li>\n</ul><p>PWA 本身强调渐进式，并不要求一次性达到安全、性能和体验上的所有要求，开发者可以通过 PWA Checklist 查看现有的特征。</p>\n<p class='div-border yellow'> Warning Header<br>\n开始pwa之前，全站必须支持HTTPS<br>\n开始pwa之前，全站必须支持HTTPS<br>\n开始pwa之前，全站必须支持HTTPS</p><h1 id=\"安装pwa\">安装pwa<a href=\"#安装pwa\" title=\"安装pwa\"></a></h1><p><code>hexo@4.2.0</code> 目前赞不兼容 <code>hexo-pwa</code>,使用 <code>hexo@4.2.0</code> 版本的用户推荐降级到 <code>hexo@4.1.1</code></p>\n<ol><li>使用<code>sudo hexo -version</code> 查看版本</li>\n<li>安装指定版本 <code>sudo npm install hexo@4.1.1 --save</code></li>\n<li>安装<code>hexo-pwa</code></li>\n</ol><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo npm install hexo-pwa --save</span><br></pre></td></tr></table></figure><h1 id=\"配置\">配置<a href=\"#配置\" title=\"配置\"></a></h1><h2 id=\"添加manifestjson\">添加manifest.json<a href=\"#添加manifestjson\" title=\"添加manifest.json\"></a></h2><p>在<code>manifest.json</code><a href=\"https://app-manifest.firebaseapp.com/\" target=\"_blank\">生成网站</a>生成manifest.json<br>首先你需要准备一个你喜欢的图标，填写香相关选项，并上传图标，将生成的manifest.json文件，放到 <strong>博客根目录下</strong><br><img src=\"https://cdn.jsdelivr.net/gh/imgyh/cdn@master/img/20200214153454.png\" class=\"φcy\" alt=\"img\"></p>\n<p>我生成的如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  &quot;name&quot;: &quot;YH&#39;s Blog&quot;,</span><br><span class=\"line\">  &quot;short_name&quot;: &quot;YH&#39;s Blog&quot;,</span><br><span class=\"line\">  &quot;theme_color&quot;: &quot;#2196f3&quot;,</span><br><span class=\"line\">  &quot;background_color&quot;: &quot;#2196f3&quot;,</span><br><span class=\"line\">  &quot;display&quot;: &quot;standalone&quot;,</span><br><span class=\"line\">  &quot;Scope&quot;: &quot;&#x2F;&quot;,</span><br><span class=\"line\">  &quot;start_url&quot;: &quot;&#x2F;&quot;,</span><br><span class=\"line\">  &quot;icons&quot;: [</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      &quot;src&quot;: &quot;images&#x2F;icons&#x2F;icon-72x72.png&quot;,</span><br><span class=\"line\">      &quot;sizes&quot;: &quot;72x72&quot;,</span><br><span class=\"line\">      &quot;type&quot;: &quot;image&#x2F;png&quot;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      &quot;src&quot;: &quot;images&#x2F;icons&#x2F;icon-96x96.png&quot;,</span><br><span class=\"line\">      &quot;sizes&quot;: &quot;96x96&quot;,</span><br><span class=\"line\">      &quot;type&quot;: &quot;image&#x2F;png&quot;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      &quot;src&quot;: &quot;images&#x2F;icons&#x2F;icon-128x128.png&quot;,</span><br><span class=\"line\">      &quot;sizes&quot;: &quot;128x128&quot;,</span><br><span class=\"line\">      &quot;type&quot;: &quot;image&#x2F;png&quot;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      &quot;src&quot;: &quot;images&#x2F;icons&#x2F;icon-144x144.png&quot;,</span><br><span class=\"line\">      &quot;sizes&quot;: &quot;144x144&quot;,</span><br><span class=\"line\">      &quot;type&quot;: &quot;image&#x2F;png&quot;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      &quot;src&quot;: &quot;images&#x2F;icons&#x2F;icon-152x152.png&quot;,</span><br><span class=\"line\">      &quot;sizes&quot;: &quot;152x152&quot;,</span><br><span class=\"line\">      &quot;type&quot;: &quot;image&#x2F;png&quot;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      &quot;src&quot;: &quot;images&#x2F;icons&#x2F;icon-192x192.png&quot;,</span><br><span class=\"line\">      &quot;sizes&quot;: &quot;192x192&quot;,</span><br><span class=\"line\">      &quot;type&quot;: &quot;image&#x2F;png&quot;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      &quot;src&quot;: &quot;images&#x2F;icons&#x2F;icon-384x384.png&quot;,</span><br><span class=\"line\">      &quot;sizes&quot;: &quot;384x384&quot;,</span><br><span class=\"line\">      &quot;type&quot;: &quot;image&#x2F;png&quot;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">      &quot;src&quot;: &quot;images&#x2F;icons&#x2F;icon-512x512.png&quot;,</span><br><span class=\"line\">      &quot;sizes&quot;: &quot;512x512&quot;,</span><br><span class=\"line\">      &quot;type&quot;: &quot;image&#x2F;png&quot;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  &quot;splash_pages&quot;: null</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><p><strong>参数解释</strong></p>\n<ul><li>name: {string} 应用名称，用于安装横幅、启动画面显示</li>\n<li>short_name: {string} 应用短名称，用于主屏幕显示</li>\n<li>theme_color: {Color} css色值theme_color 属性可以指定 PWA 的主题颜色。可以通过该属性来控制浏览器 UI 的颜色。比如 PWA 启动画面上状态栏、内容页中状态栏、地址栏的颜色，会被 theme_color 所影响。</li>\n<li>background_color: {Color} css色值 可以指定启动画面的背景颜色。</li>\n<li>display: {string} 显示类型</li>\n<li>fullscreen 应用的显示界面将占满整个屏幕</li>\n<li>standalone 浏览器相关UI（如导航栏、工具栏等）将会被隐藏</li>\n<li>minimal-ui 显示形式与standalone类似，浏览器相关UI会最小化为一个按钮，不同浏览器在实现上略有不同</li>\n<li>browser 浏览器模式，与普通网页在浏览器中打开的显示一致</li>\n<li>scope: {string} 作用域</li>\n</ul><blockquote>\n<p>scope 应遵循如下规则：<br>如果没有在 manifest 中设置 scope，则默认的作用域为 manifest.json 所在文件夹；<br>scope 可以设置为 …/ 或者更高层级的路径来扩大PWA的作用域；</p>\n</blockquote>\n<ul><li>start_url 必须在作用域范围内；</li>\n</ul><blockquote>\n<p>如果 start_url 为相对地址，其根路径受 scope 所影响；<br>如果 start_url 为绝对地址（以 / 开头），则该地址将永远以 / 作为根地址；</p>\n</blockquote>\n<ul><li>start_url: {string} 应用启动地址</li>\n<li>icons: {Array.} 应用图标列表</li>\n<li>src: {string} 图标 url</li>\n</ul><blockquote>\n<p>sizes {string} 图标尺寸，格式为widthxheight，宽高数值以 css 的 px 为单位。如果需要填写多个尺寸，则使用空格进行间隔，如”48x48 96x96 128x128”<br>type {string} 图标的 mime 类型，非必填项，该字段可让浏览器快速忽略掉不支持的图标类型</p>\n</blockquote>\n<h2 id=\"添加swjs\">添加sw.js<a href=\"#添加swjs\" title=\"添加sw.js\"></a></h2><p>新建一个名为sw.js的文件，放在<strong>站点根目录下</strong>，在文件里填入一下内容</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">importScripts(&#39;https:&#x2F;&#x2F;g.alicdn.com&#x2F;kg&#x2F;workbox&#x2F;3.3.0&#x2F;workbox-sw.js&#39;);</span><br><span class=\"line\">​</span><br><span class=\"line\">if (workbox) &#123;</span><br><span class=\"line\">    workbox.setConfig(&#123; modulePathPrefix: &#39;https:&#x2F;&#x2F;g.alicdn.com&#x2F;kg&#x2F;workbox&#x2F;3.3.0&#x2F;&#39; &#125;);</span><br><span class=\"line\">​</span><br><span class=\"line\">    workbox.precaching.precache([&#39;&#x2F;&#39;, &#39;&#x2F;index.html&#39;]);</span><br><span class=\"line\">​</span><br><span class=\"line\">    workbox.routing.registerRoute(new RegExp(&#39;^https?:&#x2F;&#x2F;dxsummer.gitee.io&#x2F;?$&#39;), workbox.strategies.networkFirst());</span><br><span class=\"line\">​</span><br><span class=\"line\">    workbox.routing.registerRoute(new RegExp(&#39;.*.html&#39;), workbox.strategies.networkFirst());</span><br><span class=\"line\">​</span><br><span class=\"line\">    workbox.routing.registerRoute(new RegExp(&#39;.*.(?:js|css|jpg|png|gif)&#39;), workbox.strategies.staleWhileRevalidate());</span><br><span class=\"line\">​</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><blockquote>\n<p>将其中域名改为你自己主页的域名：<code>https?://dxsummer.gitee.io/</code> 改为你的域名，格式要和我的一样。</p>\n</blockquote>\n<h3 id=\"配置站点配置文件\">配置站点配置文件<a href=\"#配置站点配置文件\" title=\"配置站点配置文件\"></a></h3><p>首先将生成的<code>images</code>文件复制到 <code>/source</code> 文件夹下<br>将下面的配置代码复制到你的站点根目录配置文件 <code>_config.yml</code>中</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># https:&#x2F;&#x2F;github.com&#x2F;lavas-project&#x2F;hexo-pwa</span><br><span class=\"line\">pwa:</span><br><span class=\"line\">  manifest:</span><br><span class=\"line\">    path: &#x2F;manifest.json</span><br><span class=\"line\">    body:</span><br><span class=\"line\">      name: YH&#39;s Blog</span><br><span class=\"line\">      short_name: YH&#39;s Blog</span><br><span class=\"line\">      theme_color: #2196f3</span><br><span class=\"line\">      background_color: #2196f3</span><br><span class=\"line\">      display: standalone</span><br><span class=\"line\">      orientation: portrait</span><br><span class=\"line\">      scope: &#x2F;</span><br><span class=\"line\">      start_url: &#x2F;</span><br><span class=\"line\">      icons:</span><br><span class=\"line\">        - src: &#x2F;images&#x2F;icons&#x2F;icon-72x72.png</span><br><span class=\"line\">          type: image&#x2F;png</span><br><span class=\"line\">          sizes: 72x72</span><br><span class=\"line\">        - src: &#x2F;images&#x2F;icons&#x2F;icon-96x96.png</span><br><span class=\"line\">          type: image&#x2F;png</span><br><span class=\"line\">          sizes: 96x96</span><br><span class=\"line\">        - src: &#x2F;images&#x2F;icons&#x2F;icon-128x128.png</span><br><span class=\"line\">          type: image&#x2F;png</span><br><span class=\"line\">          sizes: 128x128</span><br><span class=\"line\">        - src: &#x2F;images&#x2F;icons&#x2F;icon-144x144.png</span><br><span class=\"line\">          type: image&#x2F;png</span><br><span class=\"line\">          sizes: 144x144</span><br><span class=\"line\">        - src: &#x2F;images&#x2F;icons&#x2F;icon-152x152.png</span><br><span class=\"line\">          type: image&#x2F;png</span><br><span class=\"line\">          sizes: 152x152</span><br><span class=\"line\">        - src: &#x2F;images&#x2F;icons&#x2F;icon-192x192.png</span><br><span class=\"line\">          type: image&#x2F;png</span><br><span class=\"line\">          sizes: 192x192</span><br><span class=\"line\">        - src: &#x2F;images&#x2F;icons&#x2F;icon-384x384.png</span><br><span class=\"line\">          type: image&#x2F;png</span><br><span class=\"line\">          sizes: 384x384</span><br><span class=\"line\">        - src: &#x2F;images&#x2F;icons&#x2F;icon-512x512.png</span><br><span class=\"line\">          type: image&#x2F;png</span><br><span class=\"line\">          sizes: 512x512</span><br><span class=\"line\">  serviceWorker:</span><br><span class=\"line\">    path: &#x2F;sw.js</span><br><span class=\"line\">    preload:</span><br><span class=\"line\">      urls:</span><br><span class=\"line\">        - &#x2F;</span><br><span class=\"line\">      posts: 12</span><br><span class=\"line\">    opts:</span><br><span class=\"line\">      networkTimeoutSeconds: 30</span><br><span class=\"line\">    routes:</span><br><span class=\"line\">      - pattern: !!js&#x2F;regexp &#x2F;hm.baidu.com&#x2F;</span><br><span class=\"line\">        strategy: networkOnly</span><br><span class=\"line\">      - pattern: !!js&#x2F;regexp &#x2F;www.google-analytics.com&#x2F;</span><br><span class=\"line\">        strategy: networkOnly</span><br><span class=\"line\">      - pattern: !!js&#x2F;regexp &#x2F;.*\\.(js|css|jpg|jpeg|png|gif)$&#x2F;</span><br><span class=\"line\">        strategy: cacheFirst</span><br><span class=\"line\">      - pattern: !!js&#x2F;regexp &#x2F;\\&#x2F;&#x2F;</span><br><span class=\"line\">        strategy: networkFirst</span><br><span class=\"line\">  priority: 5</span><br></pre></td></tr></table></figure><h1 id=\"检查pwa部署是否成功\">检查pwa部署是否成功<a href=\"#检查pwa部署是否成功\" title=\"检查pwa部署是否成功\"></a></h1><p>执行<code>hexo clean &amp;&amp; hexo g &amp;&amp; hexo s</code></p>\n<p>然后在浏览器输入localhost:4000，查看效果。</p>\n<p>按F12，然后选择<code>Application—&gt;Service Workers</code>，查看是否成功？<br><a href=\"https://cdn.jsdelivr.net/gh/imgyh/cdn@master/img/20200214154647.png\" target=\"_blank\"><img src=\"https://cdn.jsdelivr.net/gh/imgyh/cdn@master/img/20200214154647.png\" alt=\"img\"></a></p>\n<blockquote>\n<p>成功状态提示：Status #xxx activated and is running</p>\n</blockquote>\n<p><strong>谷歌浏览器安装PWA</strong></p>\n<p>前面的步骤操作没错，配置也没问题，则在本地运行试，浏览器地址栏中会出现一个类似 ➕ 加号的图标，点击它会出现一个弹出框，就说明配置成功，当然你可以选择安装，安装过后桌面会出现一个图标，点击就可以访问，但是如果你本地服务关闭的话，再点击这个图标，有些页面可以访问，但有些页面访问不了。如果需要它都能够全部访问的话，你需要开启本地服务，也就是<code>hexo s</code></p>\n<p>如果你的地址栏没有出现这个加号，首先在新的标签页上的地址栏输入<code>Chrome://flags</code>，然后再搜索栏输入<code>PWAS</code>进行查找，会出现两个选项一个为<code>Desktop PWAs local updating</code>，另一个为<code>Desktop PWAs installable from the omnibox</code>，将其设为<code>Enabled</code>，然后点击<code>Relaunch</code>，进行浏览器的重启，再查看<code>localhost:4000</code>，就会出现加号了。</p>\n<h1 id=\"部署到github和coding\">部署到github和coding<a href=\"#部署到github和coding\" title=\"部署到github和coding\"></a></h1><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo hexo clean</span><br><span class=\"line\">sudo hexo g</span><br><span class=\"line\">sudo hexo d</span><br></pre></td></tr></table></figure><h1 id=\"参考资料\">参考资料<a href=\"#参考资料\" title=\"参考资料\"></a></h1><ul><li><a href=\"https://gyh.im/posts/805d5d89/#%E6%A3%80%E6%9F%A5pwa%E9%83%A8%E7%BD%B2%E6%98%AF%E5%90%A6%E6%88%90%E5%8A%9F\" target=\"_blank\">引用郭元洪</a></li>\n<li><a href=\"https://cloud.tencent.com/developer/article/1580238\" target=\"_blank\">Hexo添加PWA支持</a></li>\n</ul>","prev":{"title":"hexo博客添加live2d看板娘","link":"posts/2805db8d"},"next":{"title":"高数例题","link":"posts/7c5cf7ba"},"plink":"https://dxsummer.gitee.io/posts/805d5d89/","toc":[{"id":"前言","title":"前言","index":"1"},{"id":"安装pwa","title":"安装pwa","index":"2"},{"id":"配置","title":"配置","index":"3","children":[{"id":"添加manifestjson","title":"添加manifest.json","index":"3.1"},{"id":"添加swjs","title":"添加sw.js","index":"3.2","children":[{"id":"配置站点配置文件","title":"配置站点配置文件","index":"3.2.1"}]}]},{"id":"检查pwa部署是否成功","title":"检查pwa部署是否成功","index":"4"},{"id":"部署到github和coding","title":"部署到github和coding","index":"5"},{"id":"参考资料","title":"参考资料","index":"6"}],"reward":true,"copyright":{"author":"DxSummer","link":"<a href=\"https://dxsummer.gitee.io/posts/805d5d89/\" title=\"hexo博客开启pwa\">https://dxsummer.gitee.io/posts/805d5d89/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\\\"https://creativecommons.org/licenses/by-nc-sa/4.0/\\\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","published":"2020年5月8日","updated":"2020年6月8日"}}